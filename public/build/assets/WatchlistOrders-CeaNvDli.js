import{d as G,r as p,o as H,i as j,c as i,g as F,a as d,b as e,F as C,e as P,w as b,l as A,v as U,f as _,T as y,t as o,h as ee,j as W,n as te,m as ae,s as se,x as le}from"./app-GJEGnn89.js";const oe={key:0,class:"fixed inset-0 flex items-center justify-center bg-black/50"},re={class:"rounded bg-white p-4 text-black dark:bg-neutral-800 dark:text-white"},ne={class:"mb-2 border text-sm"},ie={class:"border px-2 py-1 text-right"},de={class:"border px-2 py-1 text-right"},ue={class:"border px-2 py-1"},pe={class:"border px-2 py-1"},ce={class:"border px-2 py-1"},ve=["onClick"],me={class:"mb-2 flex flex-wrap gap-1"},xe=["value"],be=G({__name:"FiltersModal",props:{itemId:{},show:{type:Boolean}},emits:["close"],setup(E,{emit:$}){const g=E,h=$,x=p([]),f=p({}),u=p({min_float:"",max_float:"",paint_seed:"",phase:"",fn_group:""}),M=async()=>{const v=await _.get(y("float-ranges.list")),s={};v.data.forEach(r=>{s[r.name]={min:parseFloat(r.min),max:parseFloat(r.max)}}),f.value=s};H(()=>{M()});const k=async()=>{if(g.itemId===null)return;const v=await _.get(y("watchlist.filters",{item:g.itemId}));x.value=v.data},n=async()=>{g.itemId!==null&&(await _.post(y("watchlist.filters.add",{item:g.itemId}),u.value),u.value={min_float:"",max_float:"",paint_seed:"",phase:"",fn_group:""},await k())},V=async v=>{await _.delete(y("watchlist.filters.delete",{filter:v})),await k()};return j(()=>u.value.fn_group,v=>{v&&f.value[v]?(u.value.min_float=f.value[v].min,u.value.max_float=f.value[v].max):(u.value.min_float="",u.value.max_float="")}),(v,s)=>v.show?(d(),i("div",oe,[e("div",re,[s[8]||(s[8]=e("h2",{class:"mb-2 font-bold"},"Filters",-1)),e("table",ne,[s[6]||(s[6]=e("thead",null,[e("tr",null,[e("th",{class:"border px-2 py-1"},"Min"),e("th",{class:"border px-2 py-1"},"Max"),e("th",{class:"border px-2 py-1"},"Seed"),e("th",{class:"border px-2 py-1"},"Phase"),e("th")])],-1)),e("tbody",null,[(d(!0),i(C,null,P(x.value,r=>(d(),i("tr",{key:r.id},[e("td",ie,o(r.min_float??"-"),1),e("td",de,o(r.max_float??"-"),1),e("td",ue,o(r.paint_seed??"-"),1),e("td",pe,o(r.phase??"-"),1),e("td",ce,[e("button",{onClick:w=>V(r.id),class:"border px-2"},"x",8,ve)])]))),128))])]),e("div",me,[b(e("select",{"onUpdate:modelValue":s[0]||(s[0]=r=>u.value.fn_group=r),class:"w-24 border px-1"},[s[7]||(s[7]=e("option",{value:""},"FN Group",-1)),(d(!0),i(C,null,P(f.value,(r,w)=>(d(),i("option",{key:w,value:w},o(w),9,xe))),128))],512),[[A,u.value.fn_group]]),b(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>u.value.min_float=r),placeholder:"Min",class:"w-20 border px-1"},null,512),[[U,u.value.min_float,void 0,{number:!0}]]),b(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>u.value.max_float=r),placeholder:"Max",class:"w-20 border px-1"},null,512),[[U,u.value.max_float,void 0,{number:!0}]]),b(e("input",{"onUpdate:modelValue":s[3]||(s[3]=r=>u.value.paint_seed=r),placeholder:"Seed",class:"w-20 border px-1"},null,512),[[U,u.value.paint_seed]]),b(e("input",{"onUpdate:modelValue":s[4]||(s[4]=r=>u.value.phase=r),placeholder:"Phase",class:"w-20 border px-1"},null,512),[[U,u.value.phase]]),e("button",{onClick:n,class:"border px-2"},"Add")]),e("button",{onClick:s[5]||(s[5]=r=>h("close")),class:"border px-2"},"Close")])])):F("",!0)}}),fe={class:"p-4"},_e={class:"mb-4 flex items-center gap-2"},ye={class:"flex items-center gap-1 text-sm"},ge={class:"cursor-pointer rounded border bg-gray-200 px-3 py-1 text-gray-800"},he=["disabled"],ke={key:0,class:"text-sm text-green-600"},we={key:1,class:"text-sm text-red-600"},Se={key:0,class:"mb-6 border text-sm"},Ce={class:"border px-2 py-1"},Pe={class:"border px-2 py-1 text-center"},$e=["checked","onChange"],Me={class:"border px-2 py-1 text-center"},Ve=["onClick"],Fe={key:1,class:"mb-6 flex items-center gap-2"},Ae={class:"mb-2 flex flex-wrap gap-2"},Ue=["value"],Ie=["value"],Te=["value"],Ne={class:"w-full border text-sm"},De={class:"border px-2 py-1"},Be={class:"border px-2 py-1 text-right"},je={class:"border px-2 py-1 text-right"},Ee={class:"border px-2 py-1 text-right"},Re={class:"border px-2 py-1 text-right"},Le={key:0},Oe={key:1},We={class:"border px-2 py-1 text-right"},Ge={class:"border px-2 py-1 text-right"},He={class:"border px-2 py-1 text-right"},Ke={class:"mt-2 flex items-center gap-2"},qe=10,B=20,Je=G({__name:"WatchlistOrders",setup(E){const $=p([]),g=p(""),h=p(!0),x=p(1),f=p(1),u=p(!0),M=p([]),k=p(null),n=ee({float:"",seed:"",phase:""}),V=p("profit_usd"),v=p(!1),s=p(1),r=W(()=>{let l=M.value;return n.float&&(l=l.filter(t=>String(t.floatPartValue)===n.float)),n.seed&&(l=l.filter(t=>String(t.paintSeed)===n.seed)),n.phase&&(l=l.filter(t=>String(t.phase)===n.phase)),Math.max(1,Math.ceil(l.length/B))}),w=p([]),R=p([]),L=p([]),I=p(null),T=p(!1),D=p(""),N=p(""),S=async(l=!1)=>{const t=await _.get(y("watchlist.items"),{params:{page:x.value,per_page:qe,search:g.value,active:u.value?1:0}});l?$.value=[...$.value,...t.data.data]:$.value=t.data.data,f.value=t.data.last_page},K=async()=>{x.value>=f.value||(x.value+=1,await S(!0))},q=async l=>{await _.patch(y("watchlist.toggle",{item:l.id})),l.active=!l.active};j([g,u],()=>{x.value=1,S()}),j([()=>n.float,()=>n.seed,()=>n.phase],()=>{s.value=1});const z=async()=>{await _.post(y("watchlist.deactivateAll")),await S()},J=async()=>{await _.post(y("watchlist.activateAll")),await S()},O=async()=>{const l=await _.get(y("dmarket.targets-market"));M.value=l.data;const t=new Set,a=new Set,m=new Set;M.value.forEach(c=>{c.floatPartValue&&t.add(String(c.floatPartValue)),c.paintSeed!==void 0&&c.paintSeed!==null&&a.add(String(c.paintSeed)),c.phase&&m.add(String(c.phase))}),w.value=Array.from(t).sort(),R.value=Array.from(a).sort((c,Z)=>+c-+Z),L.value=Array.from(m).sort(),s.value=1};H(async()=>{await S(),await O()});const Q=l=>{const t=l.target;t.files&&t.files.length>0&&(I.value=t.files[0])},X=async()=>{var t,a,m;T.value=!0,N.value="";const l=new FormData;I.value&&l.append("csv_file",I.value);try{await _.post(y("watchlist.import"),l),D.value="Імпорт завершено успішно.",I.value=null,await S()}catch(c){N.value=((a=(t=c.response)==null?void 0:t.data)==null?void 0:a.message)||"Сталася помилка під час імпорту.",console.error(((m=c.response)==null?void 0:m.data)||c)}finally{T.value=!1}},Y=W(()=>{let l=M.value.map(t=>{const a=Array.isArray(t.market_min_prices_usd)&&t.market_min_prices_usd.length?Math.min(...t.market_min_prices_usd):null,m=a!==null&&t.target_max_price_usd!==void 0&&t.target_max_price_usd!==null?a-t.target_max_price_usd:null,c=m!==null&&t.target_max_price_usd?m/t.target_max_price_usd*100:null;return{...t,minMarket:a,profit_usd:m,profit_percent:c}});return n.float&&(l=l.filter(t=>String(t.floatPartValue)===n.float)),n.seed&&(l=l.filter(t=>String(t.paintSeed)===n.seed)),n.phase&&(l=l.filter(t=>String(t.phase)===n.phase)),l.sort((t,a)=>{const m=t[V.value]??0,c=a[V.value]??0;return v.value?m-c:c-m}),l.slice((s.value-1)*B,s.value*B)});return(l,t)=>(d(),i("div",fe,[t[20]||(t[20]=e("h1",{class:"mb-4 text-xl font-bold"},"Watchlist Items",-1)),e("div",_e,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),placeholder:"Search...",class:"rounded border px-2 py-1"},null,512),[[U,g.value]]),e("label",ye,[b(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=a=>u.value=a)},null,512),[[se,u.value]]),t[12]||(t[12]=ae(" Active only "))]),e("button",{onClick:t[2]||(t[2]=a=>h.value=!h.value),class:"rounded border px-3 py-1"},o(h.value?"Hide list":"Show list"),1),e("button",{onClick:z,class:"rounded border px-3 py-1"},"Deactivate all"),e("button",{onClick:J,class:"rounded border px-3 py-1"},"Activate all")]),e("form",{onSubmit:le(X,["prevent"]),class:"mb-6 flex items-center gap-2",enctype:"multipart/form-data"},[e("label",ge,[t[13]||(t[13]=e("span",null,"Вибрати CSV",-1)),e("input",{type:"file",accept:".csv",class:"hidden",onChange:Q},null,32)]),e("button",{type:"submit",disabled:T.value,class:"rounded border bg-blue-600 px-3 py-1 text-white"},o(T.value?"Імпорт...":"Імпортувати"),9,he),D.value?(d(),i("span",ke,o(D.value),1)):F("",!0),N.value?(d(),i("span",we,o(N.value),1)):F("",!0)],32),h.value?(d(),i("table",Se,[t[14]||(t[14]=e("thead",{class:"bg-gray-300 text-gray-900 dark:bg-gray-700 dark:text-gray-100"},[e("tr",null,[e("th",{class:"border px-2 py-1"},"Title"),e("th",{class:"border px-2 py-1"},"Active"),e("th",{class:"border px-2 py-1"},"Filters")])],-1)),e("tbody",null,[(d(!0),i(C,null,P($.value,a=>(d(),i("tr",{key:a.id,class:"border-t"},[e("td",Ce,o(a.title),1),e("td",Pe,[e("input",{type:"checkbox",checked:a.active,onChange:m=>q(a)},null,40,$e)]),e("td",Me,[e("button",{onClick:m=>k.value=a.id,class:"rounded border px-2"},"⚙",8,Ve)])]))),128))])])):F("",!0),h.value?(d(),i("div",Fe,[e("button",{onClick:t[3]||(t[3]=a=>{x.value=Math.max(1,x.value-1),S()}),class:"border px-2"}," Prev "),e("span",null,"Page "+o(x.value)+" / "+o(f.value),1),x.value<f.value?(d(),i("button",{key:0,onClick:K,class:"border px-2"},"Load more")):F("",!0)])):F("",!0),e("button",{onClick:O,class:"mb-4 rounded border px-3 py-1"},"Refresh Comparison"),e("div",Ae,[b(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>n.float=a),class:"rounded border px-2 py-1"},[t[15]||(t[15]=e("option",{value:""},"Float",-1)),(d(!0),i(C,null,P(w.value,a=>(d(),i("option",{key:a,value:a},o(a),9,Ue))),128))],512),[[A,n.float]]),b(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>n.seed=a),class:"rounded border px-2 py-1"},[t[16]||(t[16]=e("option",{value:""},"Seed",-1)),(d(!0),i(C,null,P(R.value,a=>(d(),i("option",{key:a,value:a},o(a),9,Ie))),128))],512),[[A,n.seed]]),b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>n.phase=a),class:"rounded border px-2 py-1"},[t[17]||(t[17]=e("option",{value:""},"Phase",-1)),(d(!0),i(C,null,P(L.value,a=>(d(),i("option",{key:a,value:a},o(a),9,Te))),128))],512),[[A,n.phase]]),b(e("select",{"onUpdate:modelValue":t[7]||(t[7]=a=>V.value=a),class:"rounded border px-2 py-1"},t[18]||(t[18]=[e("option",{value:"target_max_price_usd"},"Target Max $",-1),e("option",{value:"profit_usd"},"Profit $",-1),e("option",{value:"profit_percent"},"Profit %",-1)]),512),[[A,V.value]]),e("button",{onClick:t[8]||(t[8]=a=>v.value=!v.value),class:"rounded border px-2"},"Sort "+o(v.value?"↑":"↓"),1)]),e("table",Ne,[t[19]||(t[19]=e("thead",{class:"bg-gray-300 text-gray-900 dark:bg-gray-700 dark:text-gray-100"},[e("tr",null,[e("th",{class:"border px-2 py-1"},"Title"),e("th",{class:"border px-2 py-1"},"Float"),e("th",{class:"border px-2 py-1"},"Seed"),e("th",{class:"border px-2 py-1"},"Phase"),e("th",{class:"border px-2 py-1"},"Market Min $ (3)"),e("th",{class:"border px-2 py-1"},"Target Max $"),e("th",{class:"border px-2 py-1"},"Profit $"),e("th",{class:"border px-2 py-1"},"Profit %")])],-1)),e("tbody",null,[(d(!0),i(C,null,P(Y.value,a=>(d(),i("tr",{key:a.title+a.floatPartValue+a.paintSeed+a.phase,class:"border-t"},[e("td",De,o(a.title),1),e("td",Be,o(a.floatPartValue),1),e("td",je,o(a.paintSeed),1),e("td",Ee,o(a.phase),1),e("td",Re,[Array.isArray(a.market_min_prices_usd)&&a.market_min_prices_usd.length?(d(),i("span",Le,o(a.market_min_prices_usd.join(", ")),1)):(d(),i("span",Oe,"-"))]),e("td",We,o(a.target_max_price_usd??"-"),1),e("td",Ge,o(a.profit_usd!==null?a.profit_usd.toFixed(2):"-"),1),e("td",He,o(a.profit_percent!==null?a.profit_percent.toFixed(2)+"%":"-"),1)]))),128))])]),e("div",Ke,[e("button",{onClick:t[9]||(t[9]=a=>s.value=Math.max(1,s.value-1)),class:"border px-2"},"Prev"),e("span",null,"Page "+o(s.value)+" / "+o(r.value),1),e("button",{onClick:t[10]||(t[10]=a=>s.value=Math.min(r.value,s.value+1)),class:"border px-2"},"Next")]),te(be,{show:k.value!==null,"item-id":k.value,onClose:t[11]||(t[11]=a=>k.value=null)},null,8,["show","item-id"])]))}});export{Je as default};
